#======================================================================
    Testing script for Panel.jl (inviscid panel1)

    USAGE: run the following lines on your terminal:
        `cd /path/to/AirfoilInverseDesign/test/`
        `julia 02_test_panel1.jl`

    Author: Andrea Pavan
    Project: AirfoilInverseDesign.jl package
    License: MIT
    Date: 21/08/2023
======================================================================#
using Plots;
include("../src/airfoilutils.jl");
include("../src/panel.jl");


#analyze a NACA airfoil with panel1
(airfoil,airfoilheader) = generatenaca4airfoil("4412",100);
α = [1 2 3];
(cp,CL,CM,CD,λ) = panel1(airfoil,α);
println(airfoilheader);
for i=1:length(α)
    println("\tα=",round(α[i],digits=2),"°\tCL=",round(CL[i],digits=6),"\tCD=",round(CD[i],digits=6),"\tCM=",round(CM[i],digits=6));
end
plt1 = plot(cp[:,1], cp[:,2:end],
    title = "Pressure distribution - "*airfoilheader,
    #label = ["α = 3°" "α = 4°"],
    label = "α = ".*string.(α).*"°",
    xlabel = "x/c",
    ylabel = "cp",
    yflip = true
);
display(plt1);


#validate results with xfoil (inviscid)
(airfoil1,airfoil1header) = generatenaca4airfoil("2412",100);
(cp1,_,_,_,_) = panel1(airfoil1,5);
airfoil1xfoil = [0.99899, 0.99304, 0.98280, 0.97075, 0.95708, 0.94223, 0.92666, 0.91068, 0.89448, 0.87816, 0.86179, 0.84537, 0.82893, 0.81247, 0.79599, 0.77950, 0.76299, 0.74648, 0.72996, 0.71343, 0.69690, 0.68037, 0.66383, 0.64729, 0.63075, 0.61421, 0.59768, 0.58116, 0.56464, 0.54812, 0.53163, 0.51514, 0.49866, 0.48221, 0.46578, 0.44938, 0.43299, 0.41666, 0.40044, 0.38432, 0.36829, 0.35231, 0.33639, 0.32051, 0.30469, 0.28893, 0.27324, 0.25762, 0.24210, 0.22667, 0.21136, 0.19618, 0.18115, 0.16632, 0.15171, 0.13739, 0.12342, 0.10992, 0.09700, 0.08483, 0.07356, 0.06334, 0.05425, 0.04627, 0.03935, 0.03337, 0.02821, 0.02374, 0.01985, 0.01647, 0.01351, 0.01092, 0.00866, 0.00669, 0.00500, 0.00356, 0.00236, 0.00141, 0.00070, 0.00023, 0.00003, 0.00007, 0.00010, 0.00050, 0.00115, 0.00206, 0.00323, 0.00465, 0.00633, 0.00829, 0.01052, 0.01306, 0.01594, 0.01918, 0.02287, 0.02706, 0.03186, 0.03737, 0.04373, 0.05109, 0.05957, 0.06927, 0.08021, 0.09231, 0.10541, 0.11932, 0.13386, 0.14889, 0.16428, 0.17995, 0.19586, 0.21195, 0.22819, 0.24456, 0.26105, 0.27764, 0.29432, 0.31107, 0.32790, 0.34478, 0.36173, 0.37871, 0.39569, 0.41264, 0.42953, 0.44640, 0.46331, 0.48025, 0.49721, 0.51419, 0.53119, 0.54822, 0.56526, 0.58232, 0.59940, 0.61649, 0.63359, 0.65071, 0.66783, 0.68496, 0.70210, 0.71925, 0.73639, 0.75354, 0.77069, 0.78784, 0.80499, 0.82214, 0.83927, 0.85639, 0.87348, 0.89052, 0.90745, 0.92415, 0.94042, 0.95589, 0.97004, 0.98243, 0.99290, 0.99899];
cp1xfoil = [0.47881, 0.23046, 0.18166, 0.11910, 0.06860, 0.02510, -0.01413, -0.04930, -0.08142, -0.11077, -0.13861, -0.16444, -0.18960, -0.21323, -0.23631, -0.25832, -0.28059, -0.30147, -0.32260, -0.34298, -0.36357, -0.38405, -0.40406, -0.42405, -0.44459, -0.46480, -0.48538, -0.50577, -0.52641, -0.54783, -0.56910, -0.59076, -0.61288, -0.63607, -0.65932, -0.68328, -0.70802, -0.73636, -0.76668, -0.79588, -0.82339, -0.85017, -0.87598, -0.90203, -0.92736, -0.95341, -0.97915, -1.00515, -1.03122, -1.05800, -1.08546, -1.11327, -1.14198, -1.17195, -1.20262, -1.23528, -1.27030, -1.30673, -1.34601, -1.38785, -1.43219, -1.47932, -1.52758, -1.57819, -1.62656, -1.67840, -1.72463, -1.77374, -1.81502, -1.85360, -1.88939, -1.90623, -1.92025, -1.90915, -1.86490, -1.80081, -1.68600, -1.50589, -1.25890, -0.98125, -0.67289, -0.32986, -0.00267, 0.29987, 0.56466, 0.76549, 0.89854, 0.97244, 0.99924, 0.99150, 0.96073, 0.91566, 0.86201, 0.80402, 0.74458, 0.68466, 0.62577, 0.56849, 0.51397, 0.46154, 0.41303, 0.36808, 0.32815, 0.29296, 0.26280, 0.23750, 0.21645, 0.19910, 0.18516, 0.17369, 0.16408, 0.15679, 0.15056, 0.14580, 0.14186, 0.13867, 0.13605, 0.13404, 0.13209, 0.13037, 0.12891, 0.12639, 0.12364, 0.11983, 0.11689, 0.11563, 0.11525, 0.11487, 0.11536, 0.11523, 0.11605, 0.11694, 0.11756, 0.11870, 0.11983, 0.12113, 0.12216, 0.12384, 0.12502, 0.12692, 0.12850, 0.13010, 0.13190, 0.13411, 0.13634, 0.13898, 0.14158, 0.14494, 0.14817, 0.15265, 0.15763, 0.16353, 0.17049, 0.17987, 0.19171, 0.20664, 0.22664, 0.25833, 0.27460, 0.47881];
plt2 = plot(cp1[:,1], cp1[:,2:end],
    title = "Pressure distribution - "*airfoil1header, label="panel1",
    xlabel = "x/c",
    ylabel = "cp",
    yflip = true
);
idxxfoil = 1:3:length(airfoil1xfoil);        #hide some points to see both curves
scatter!(plt2, airfoil1xfoil[idxxfoil], cp1xfoil[idxxfoil], label="xfoil")
display(plt2);
